---
date: 2022-09-17
description: "elasticsearch åˆæ­¥ä½¿ç”¨"
image: "images/es.png"
title: "elasticsearch åˆæ­¥ä½¿ç”¨"
author: è¯¸è‘›é’
authorEmoji: ğŸ˜ƒ
pinned: false
tags:
- elasticsearch
series:
- 
---


## ä¸ºä»€ä¹ˆå­¦ä¹ Elasticsearch
* Elasticsearchgé«˜æ€§èƒ½ï¼Œå®¹æ˜“ä½¿ç”¨ï¼Œå®¹æ˜“æ‰©å±•
* Elasticsearchå¯ä»¥ä½œä¸ºåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œè¿˜å¯ä»¥ç”¨äºå¤§æ•°æ®è¿‘å®æ—¶åˆ†æã€‚

## åŸºæœ¬æ¦‚å¿µ

### æ–‡æ¡£
* Elasticsearch æ˜¯é¢å‘æ–‡æ¡£çš„ï¼Œæ–‡æ¡£æ˜¯æ‰€æœ‰å¯æœç´¢æ•°æ®çš„æœ€å°å•ä½
    * æ¯”å¦‚æ—¥å¿—æ–‡ä»¶ä¸­çš„æ—¥å¿—é¡¹
    * ä¸€ä¸ªç”µå½±çš„å…·ä½“ä¿¡æ¯
    * MP3çš„ä¸€é¦–æ­Œ
* æ–‡æ¡£è¢«åºåˆ—åŒ–ç¨‹ JSONæ ¼å¼ï¼Œä¿å­˜åˆ° Elasticsearchä¸­
* æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰è‡ªå·±çš„ Unique ID
    * å¯ä»¥è‡ªå·±æŒ‡å®šIDï¼Œä¹Ÿå¯ä»¥ç”±Elasticsearchè‡ªåŠ¨ç”Ÿæˆ
* æ–‡æ¡£ä¸­å¯ä»¥æœ‰ä¸€äº›å…ƒæ•°æ®
    * _indexï¼šæ–‡æ¡£æ‰€å±ç´¢å¼•å
    * _typeï¼šæ–‡æ¡£æ‰€å±ç±»å‹å
    * _idï¼šæ–‡æ¡£ID
    * _sourceï¼šæ–‡æ¡£çš„åŸå§‹Jsonæ•°æ®
    * _versionï¼šæ–‡æ¡£çš„ç‰ˆæœ¬
    * _scoreï¼šæ–‡æ¡£çš„ç›¸åº”è¯„åˆ†

### ç´¢å¼•
* ç´¢å¼•æ˜¯æ–‡æ¡£çš„å®¹å™¨ï¼Œæ˜¯ä¸€ç±»æ–‡æ¡£çš„ç»“åˆ
    * æ¯ä¸€ä¸ªç´¢å¼•å¤šæœ‰è‡ªå·±çš„Mapping å’Œ Setting
    * Mappingå®šä¹‰æ–‡æ¡£å­—æ®µçš„ç±»å‹
    * Settingå®šä¹‰ä¸åŒæ•°æ®çš„åˆ†å¸ƒ

### å€’æ’ç´¢å¼•
* æ­£æ’ç´¢å¼•æ˜¯ ä»ä¸€ä¸ªæ–‡æ¡£ID æ‰¾åˆ° æ–‡æ¡£å†…å­˜æˆ–å•è¯
* å€’æ’ç´¢å¼•æ˜¯ ä»ä¸€ä¸ªå•è¯ æ‰¾åˆ°æ–‡æ¡£çš„ID
* å€’æ’ç´¢å¼•åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†
    * å•è¯è¯å…¸ï¼šè®°å½•æ‰€æœ‰æ–‡æ¡£çš„å•è¯ï¼Œè®°å½•å•è¯åˆ°å€’æ’åˆ—è¡¨çš„å…³è”å…³ç³»
    * å€’æ’åˆ—è¡¨ï¼šè®°å½•å•è¯å¯¹åº”çš„æ–‡æ¡£é›†åˆï¼Œç”±å€’æ’ç´¢å¼•é¡¹ç»„æˆ
        * å€’æ’ç´¢å¼•é¡¹åŒ…æ‹¬ æ–‡æ¡£IDï¼Œå•è¯å‡ºç°æ¬¡æ•°ï¼Œå•è¯åœ¨è¯­å¥ä¸­çš„ä½ç½®ï¼Œå•è¯çš„å¼€å§‹ç»“æŸä½ç½®


## å¸¸ç”¨API
> put ç”¨äºæŒ‡å®šIDçš„æƒ…å†µ
### å¢åŠ ä¸€ä¸ªæ–‡æ¡£

* è‡ªåŠ¨ç”ŸæˆID    
```shell 
post users/_doc
{
  "user": "zhugeqing"
}
```

* æŒ‡å®šIDï¼Œå¦‚æœIDå­˜åœ¨å°±æŠ¥é”™
```shell 
put users/_doc/1?op_type=create
{
  "user": "elk"
}
```

### æ›´æ–°ä¸€ä¸ªæ–‡æ¡£
* ç›´æ¥æ›´æ–°ï¼ˆç‰ˆæœ¬åŠ 1ï¼‰
```shell 
PUT users/_doc/1
{
	"user" : "elk"
}
```

### æŸ¥çœ‹ä¸€ä¸ªæ–‡æ¡£
```shell
GET users/_doc/1
```

### åˆ é™¤ä¸€ä¸ªæ–‡æ¡£
```shell
DELETE users/_doc/1
```

### Bulk API
```shell
POST _bulk
{ "index" : { "_index" : "test", "_id" : "1" } }
{ "field1" : "value1" }
{ "delete" : { "_index" : "test", "_id" : "2" } }
{ "create" : { "_index" : "test", "_id" : "3" } }
{ "field1" : "value3" }
{ "update" : {"_id" : "1", "_index" : "test"} }
{ "doc" : {"field2" : "value2"} }
```
> bulk API æ”¯æŒåœ¨ä¸€æ¬¡APIè°ƒç”¨ä¸­ï¼Œå¯¹ä¸åŒçš„ç´¢å¼•è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œæ”¯æŒï¼ˆIndexï¼ŒCreateï¼ŒUpdateï¼ŒDeleteï¼‰
> å•æ¡æ“ä½œå¤±è´¥ï¼Œä¸ä¼šå½±å“å…¶ä»–æ“ä½œç»“æœ
> ä¸Šä¾‹ ç¬¬ä¸€ä¸ªæ“ä½œä¸º å‘ testç´¢å¼• IDä¸º1çš„æ–‡æ¡£ è¿›è¡Œindexï¼Œsourceä¸º{ "field1" : "value1" }
> ç¬¬äºŒä¸ªæ“ä½œä¸ºåˆ é™¤ testç´¢å¼•ä¸­IDä¸º2çš„æ–‡æ¡£

### æ‰¹é‡è¯»å–(mget)
> æ‰¹é‡è¯»å–å¯ä»¥å‡å°‘ç½‘ç»œè¿æ¥æ‰€äº§ç”Ÿçš„å¼€é”€ï¼Œæé«˜æ€§èƒ½

```shell
GET /_mget
{
  "docs": [
    {
      "_index": "users",
      "_id": "1"
    },
    {
      "_index": "test",
      "_id": "2"
    }
  ]
}
```

### æ‰¹é‡æŸ¥è¯¢(msearch)
```shell
POST /_msearch
{"index": "kibana_sample_data_ecommerce"}
{"query": {"match_all": {}}, "size": 1}
```


## åˆ†è¯



