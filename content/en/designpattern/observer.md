---
date: 2022-10-10
description: "è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼"
image: "images/solo.jpg"
title: "è§‚å¯Ÿè€…æ¨¡å¼"
author: è¯¸è‘›é’
authorEmoji: ğŸ˜ƒ
pinned: false
tags:
- è®¾è®¡æ¨¡å¼
series:
- 
---

## ä½¿ç”¨åœºæ™¯
* `è§‚å¯Ÿè€…æ¨¡å¼`ä¹Ÿå¯ä»¥è¢«å«åš`å‘å¸ƒâ€”â€”è®¢é˜…æ¨¡å¼`ï¼Œåªè¦æ˜¯åœºæ™¯çš„å‘å¸ƒè®¢é˜…åœºæ™¯å°±å¯ä»¥ä½¿ç”¨
* ä¸¾ä¾‹ï¼šä¸€ä¸ªå…¬å¸é‡Œæœ‰å‡ ä¸ªç¨‹åºå‘˜å–œæ¬¢åœ¨è€æ¿ç¦»å¼€å…¬å¸çš„æ‘¸é±¼ï¼Œä½†æ˜¯å¦‚æœè¢«è€æ¿å›æ¥å‘ç°çš„è¯ï¼Œé‚£å°±å®Œè›‹äº†ï¼Œæ‰€ä»¥è¿™å‡ ä¸ªç¨‹åºå‘˜å†³å®šè·Ÿå‰å°çš„å§å§ æ‰“å¥½å…³ç³»ï¼Œåœ¨è€æ¿å›åˆ°å…¬å¸ä¹‹åï¼Œç«‹é©¬å‘é€æ¶ˆæ¯é€šçŸ¥ä»–ä»¬ï¼Œè¿™æ ·è¿™å‡ ä¸ªç¨‹åºå‘˜å°±èƒ½åœ¨æ‘¸é±¼ ä¸ å·¥ä½œä¹‹é—´åå¤æ¨ªè·³ã€‚è€Œè¿™é‡Œçš„ç¨‹åºå‘˜å°±å¯ä»¥å½“åš`è®¢é˜…è€…`ï¼Œå‰å°å½“åš`å‘å¸ƒè€…`ï¼Œå½“å‰å°å‘å¸ƒè€æ¿å›æ¥çš„æ¶ˆæ¯çš„æ—¶å€™ï¼Œç¨‹åºå‘˜ä»¬å°±å¿…é¡»ç«‹å³ä½œå‡ºååº”
* `ç®€å•çš„è¯´ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜éœ€è¦åŒæ—¶æ”¹å˜å…¶ä»–å¯¹è±¡çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼`
> æ¥è‡ªã€Šå¤§è¯è®¾è®¡æ¨¡å¼ã€‹ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼ æ•…äº‹ï¼Œè®¢é˜…è€…ä¹Ÿæ˜¯è§‚å¯Ÿè€…ï¼›å‘å¸ƒè€…ä¹Ÿæ˜¯é€šçŸ¥è€…ï¼Œæˆ–æ˜¯ä¸»é¢˜


## ä¼˜ç¼ºç‚¹
* ä¼˜ç‚¹ï¼š
    1. è§‚å¯Ÿè€…æ¨¡å¼æ»¡è¶³â€œå¼€-é—­åŸåˆ™â€ã€‚ä¸»é¢˜æ¥å£ä»…ä»…ä¾èµ–äºè§‚å¯Ÿè€…æ¥å£ï¼Œè€Œè§‚å¯Ÿè€…å…·ä½“æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥è‡ªè¡Œå®ç°
    2. è€¦åˆçš„åŒæ–¹éƒ½ä¾èµ–ä¸æŠ½è±¡ï¼Œè€Œä¸æ˜¯ä¾èµ–å…·ä½“çš„å®ç°
* ç¼ºç‚¹ï¼š
    1. å¦‚æœé€šçŸ¥çš„è§‚å¯Ÿè€…è¾ƒå¤šï¼Œå°†ä¼šè€—è´¹ä¸å°‘æ—¶é—´
    2. å¦‚æœè§‚å¯Ÿè€…å’Œè§‚å¯Ÿç›®æ ‡ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©
## C++å®ç°

### æŠ½è±¡å‘å¸ƒè€…æ¥å£
```h:Subject.h
#pragma once
#include <string>
#include "Observer.h"

// æŠ½è±¡å‘å¸ƒè€…â€”â€”é€šçŸ¥è€…ï¼ˆæŠ½è±¡ä¸»é¢˜ï¼‰
class Subject {
public:
    virtual void Attach(Observer * observer) = 0;  // æ³¨å†Œè®¢é˜…è€…
    virtual void Detach(Observer * observer) = 0;  // æ³¨é”€è®¢é˜…è€…
    virtual void Notify(string) = 0;  // é€šçŸ¥è®¢é˜…è€…
private:
};
```


### å…·ä½“å‘å¸ƒè€…â€”â€”å‰å°
```h:ConcreteSubject.h
#pragma once
#include <list>
#include "Observer.h"
#include "IObject.h"
using namespace std;

// å…·ä½“å‘å¸ƒè€…â€”â€”æ¯”å¦‚å‰å°
class ConcreteSubject: public IObject{
public:
    // æ³¨å†Œè®¢é˜…è€…
    void Attach(Observer* observer) {
        observers.push_back(observer);
    }

    // æ³¨é”€è®¢é˜…è€…
    void Detach(Observer* observer) {
        observers.remove(observer);
    }

    // é€šçŸ¥è®¢é˜…è€…(ä¸€æ¬¡æ€§é€šçŸ¥æ‰€æœ‰)
    void Notify(string event) {
        for(auto it : observers) {
            it->Update(event);
        }
    }

private:
    list<Observer *> observers;
};
```

### æŠ½è±¡è®¢é˜…è€…(æŠ½è±¡è§‚å¯Ÿè€…)
```h:Observer.h
#pragma once
#include <string>
using namespace std;
// æŠ½è±¡ç±»è§‚å¯Ÿè€…
class Observer {
public:
    virtual void Update(string) = 0; // æ”¶åˆ°é€šçŸ¥ï¼Œåšå‡ºè¡ŒåŠ¨

};
```


### å…·ä½“è®¢é˜…è€…â€”â€”ç¨‹åºå‘˜
```h:Programmer.h
#pragma once
#include <string>
#include <iostream>
#include "Observer.h"
#include "ConcreteSubject.h"
using namespace std;

// å…·ä½“è§‚å¯Ÿè€…â€”â€”å¯ä»¥æ ¹æ®ä¸åŒçš„å²—ä½å¤„ç†ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯ç¨‹åºå‘˜ï¼Œè¿˜å¯ä»¥æ˜¯äº§å“ç»ç†
class Programmer: public Observer {
public:
    Programmer(string &name, Subject * mySubject) :
        my_name(name),
        my_subject(mySubject)
        {}

    void Update(string event) override {
        my_event = event;
        cout << my_name << "æ”¶åˆ°å‰å°é€šçŸ¥ï¼š" << my_event << endl;
    }

private:
    string my_name; // è§‚å¯Ÿè€…åå­—
    string my_event; // è§‚å¯Ÿè€…å½“å‰æ”¶åˆ°é€šçŸ¥
    Subject* my_subject; // è®¢é˜…çš„ä¸»é¢˜ï¼Œæˆ–è€…æ˜¯ å…³è”çš„ å‘å¸ƒè€…
};

```

### å…·ä½“è®¢é˜…è€…â€”â€”äº§å“ç»ç†
```h:ProductManager.h

#pragma once
#include <string>
#include <iostream>
#include "Observer.h"
#include "Subject.h"

using namespace std;

// å…·ä½“è§‚å¯Ÿè€…â€”â€”å¯ä»¥æ ¹æ®ä¸åŒçš„å²—ä½å¤„ç†ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯ç¨‹åºå‘˜ï¼Œè¿˜å¯ä»¥æ˜¯äº§å“ç»ç†
class ProductManager: public Observer { // äº§å“ç»ç†
public:
    ProductManager(string &name, Subject* mySubject) :
        my_name(name),
        my_subject(mySubject)
        {}

    void Update(string event) override {
        my_event = event;
        cout << my_name << "æ”¶åˆ°å‰å°é€šçŸ¥ï¼š" << my_event << endl;
    }

private:
    string my_name; // è§‚å¯Ÿè€…åå­—
    string my_event; // è§‚å¯Ÿè€…å½“å‰æ”¶åˆ°é€šçŸ¥
    Subject* my_subject; // è®¢é˜…çš„ä¸»é¢˜ï¼Œæˆ–è€…æ˜¯ å…³è”çš„ å‘å¸ƒè€…
};

```

### å®¢æˆ·ç«¯æ‰§è¡Œ
```cpp:main.cpp
#include "ConcreteSubject.h"
#include "Programmer.h"
#include "ProductManager.h"
int main()
{
    // åˆ›å»ºä¸€ä¸ªä¸»é¢˜ï¼ˆé€šçŸ¥è€…ï¼‰ï¼Œå‰å°
    auto subject = new ConcreteSubject();
    string name1 = "éº¦å½“";
    string name2 = "å’•å’š";
    string name3 = "ç¬›äºš";
    // ç¨‹åºå‘˜
    auto* ob1 = new Programmer(name1, subject);
    // ç¨‹åºå‘˜â€”â€”è§‚å¯Ÿè€…
    auto* ob2 = new Programmer(name2, subject);

    // äº§å“ç»ç†
    auto* ob3 = new ProductManager(name3, subject);

    // è§‚å¯Ÿè€…1 è®¢é˜… ä¸»é¢˜
    subject->Attach(ob1);
    // è§‚å¯Ÿè€…2 è®¢é˜… ä¸»é¢˜
    subject->Attach(ob2);
    // è§‚å¯Ÿè€…3 è®¢é˜… ä¸»é¢˜
    subject->Attach(ob3);

    // é€šçŸ¥ç¨‹åºå‘˜
    subject->Notify("è€æ¿èµ°äº†ï¼Œå¼€å§‹è¿½æ±‚è‡ªç”±å§ï¼");

    // é€šçŸ¥è€…ç¨‹åºå‘˜
    subject->Notify("è€æ¿å›æ¥äº†ï¼Œèµ¶ç´§å¼€å§‹å·¥ä½œ");

    // æ³¨é”€ï¼šä¸‹ç­äº†ï¼Œä¸éœ€è¦å‰å°æ¥é€šçŸ¥äº†
    subject->Detach(ob1);
    subject->Detach(ob2);
    subject->Detach(ob3);

    return 0;
}
```