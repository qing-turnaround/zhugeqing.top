---
date: 2021-12-10
description: "imageçš„åˆ›å»ºç®¡ç†å’Œå‘å¸ƒ"
image: "images/docker.svg"
title: "Dockeré•œåƒ"
author: è¯¸è‘›é’
authorEmoji: ğŸ˜ƒ
pinned: false
tags:
- docker
series:
- 
---


## è·å–image
> è·å–imageçš„ä¸»è¦æ–¹å¼
1. ä»registryä¸Šæ‹‰å–(`pull`)
2. ä½¿ç”¨DockerFileæ„å»º(`build`)
3. ä»ç¦»çº¿æ–‡ä»¶ä¸­å¯¼å…¥(`load`)
4. ä»è¿›è¡Œä¿®æ”¹åå®¹å™¨ä¸­æäº¤åˆ°ä¸€ä¸ªæ–°çš„é•œåƒ(`commit`)

<img src="/images/docker/docker-stages.png" width="70%" height="50%">

### ç¬¬ä¸€ç§æ–¹å¼ï¼ˆpullï¼‰
> æ¯”è¾ƒå¸¸ç”¨çš„registryæœ‰[Dock hub](https://hub.docker.com/) å’Œ [Quay](https://quay.io/) 

1. æ‹‰å–nginxé•œåƒâ€”â€”`docker pull nginx`ï¼ˆdocker hubï¼‰
> é»˜è®¤æ˜¯æ‹‰å–æœ€æ–°ç‰ˆæœ¬ï¼Œè‹¥è¦æ‹‰å–å…¶ä»–ç‰ˆæœ¬ï¼Œåˆ™ç”¨å‘½ä»¤`docker pull nginx:1.21.4`ï¼ˆ`1.21.4`ä¸ºç‰ˆæœ¬å·ï¼Œå‰é¢åŠ `:`ï¼‰
> è‹¥æ˜¯å…¶ä»–`registry`ï¼Œæ¯”å¦‚[Quay](https://quay.io/) ï¼Œå¯ä»¥è¿›å…¥å®˜ç½‘æŸ¥çœ‹ç›¸å…³``æ‹‰å–è·¯å¾„å’Œç‰ˆæœ¬å·``


{{< notice info >}}
å¯ä»¥ä½¿ç”¨`docker image inspect nginx`æŸ¥çœ‹imageçš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚å®Œæ•´IDå·ï¼Œtagï¼Œé€‚ç”¨æ¶æ„ã€ç³»ç»Ÿç­‰ï¼‰
{{< /notice >}}

### ç¬¬äºŒç§æ–¹å¼ï¼ˆbuildï¼‰
> Dockerfileæ˜¯ç”¨äºæ„å»ºdockeré•œåƒçš„æ–‡ä»¶
> Dockerfileé‡ŒåŒ…å«äº†æ„å»ºé•œåƒæ‰€éœ€çš„â€œæŒ‡ä»¤â€
> Dockerfileæœ‰å…¶ç‰¹å®šçš„è¯­æ³•è§„åˆ™
1. ç¼–å†™DockerFile
```Dockerfile
FROM ubuntu:21.04
RUN apt-get update && \
    DEBIAN_FRONTEND=noninteractive apt-get install --no-install-recommends -y python3.9 python3-pip python3.9-dev
ADD hello.py /
CMD ["python3", "/hello.py"]
```
2. ç¼–å†™ä»»æ„Pythonæ–‡ä»¶
```Python
print("ä½ å¥½,è¯¸è‘›é’ï¼")
```

3. é€šè¿‡buildæ„å»ºé•œåƒ
`docker image build -t hello:1.0 .`ï¼ˆ`-tè¡¨ç¤ºtag`ï¼Œ`hello:1.0ä¸ºé•œåƒååŠ ç‰ˆæœ¬å·`ï¼Œ`.è¡¨ç¤ºbuild contextï¼ˆæ„å»ºé•œåƒéœ€è¦å‘é€åˆ°é•œåƒé‡Œé¢çš„ç›®å½•ï¼Œè¿™é‡Œçš„.è¡¨ç¤ºdockerfileæ‰€åœ¨ç›®å½•ï¼‰,è‹¥åŠ -få‚æ•°ï¼Œåˆ™å¯ä»¥dockerfileå¯ä»¥å•ç‹¬æŒ‡å®šè·¯å¾„`ï¼‰


### ç¬¬ä¸‰ç§æ–¹å¼ï¼ˆloadï¼‰
å°†é•œåƒæ–‡ä»¶å¯¼å‡ºï¼š`docker image save nginx:1.21.4 -o nginx_1.12.4_image`ï¼ˆé€‰é¡¹-oè¡¨ç¤ºè¾“å‡ºï¼‰
å°†é•œåƒæ–‡ä»¶å¯¼å…¥ï¼š`docker image load -i nginx_1.12.4_image`ï¼ˆé€‰é¡¹-iè¡¨ç¤ºè¾“å…¥ï¼‰


### ç¬¬å››ç§æ–¹å¼ï¼ˆcommitï¼‰
1. ä½¿ç”¨`docker container run --publish 214:80 -it nginx:1.21.4 sh`
{{< notice info >}}
`--publish 214:80`è¡¨ç¤ºå°†dockerå†…çš„80ç«¯å£æ˜ å°„ä¸ºä¸»æœºçš„214ç«¯å£ï¼Œ`-it`è¡¨ç¤ºä»¥äº¤äº’å¼çš„æ–¹å¼è¿è¡Œï¼Œ`sh`è¡¨ç¤ºæ‰“å¼€shell
{{< /notice >}}

2. `cd /usr/share/nginx/html` ï¼Œ`echo "<h> ä½ å¥½ è¯¸è‘›é’ï¼</h>" > index.html`ï¼Œ`exit`
{{< notice info >}}
ç¬¬ä¸€æ¡å‘½ä»¤æ˜¯è½¬åˆ°nginxçš„index.htmlçš„å­˜å‚¨è·¯å¾„ä¸‹ï¼Œç¬¬äºŒæ¡å‘½ä»¤æ˜¯ä¿®æ”¹é»˜è®¤çš„index.htmlï¼Œç¬¬ä¸‰æ¡å‘½ä»¤æ˜¯é€€å‡ºå®¹å™¨çš„shell
{{< /notice >}}

3. ä½¿ç”¨`docker container commit f12 zhugeqing/nginx`
{{< notice info >}}
`f12`ä¸ºå¼€å¯å®¹å™¨çš„IDï¼Œ`zhugeqing/nginx`ä¸ºæ‰“åŒ…ä¹‹åçš„é•œåƒå
{{< /notice >}}

`docker container commit c5 zhugeqing/nginx`å°†æ­£åœ¨IDå‰ç¼€ä¸ºc5çš„å®¹å™¨æ‰“åŒ…æˆåå­—ä¸º"zhugeqing/nginx"çš„é•œåƒ

## åˆ é™¤image
åˆ é™¤`image`ä½¿ç”¨`docker image rm 2f1`ã€‚ï¼ˆ2f1ä¸ºé•œåƒçš„IDå·å‰ç¼€ï¼Œæˆ–è€…æ˜¯imageåå­—:tagçš„å½¢å¼ï¼‰
{{< alert theme="info" >}}
åˆ é™¤çš„å‰ææ˜¯è¯¥é•œåƒæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¦‚æœç”¨è¯¥é•œåƒè¿è¡Œäº†ä¸€ä¸ª`container`ï¼Œå°±ç®—æ˜¯åœæ­¢äº†è¿è¡Œï¼Œä¹Ÿä¸€æ ·ä¸èƒ½åˆ é™¤ï¼Œå› ä¸ºåœæ­¢çš„`container`å¯èƒ½ä¼šåœ¨ä¹‹åè¿è¡Œï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥åˆ é™¤`image`ï¼Œéœ€è¦å…ˆä½¿ç”¨`imgae container stop d61`åœæ­¢å®¹å™¨è¿è¡Œå†ç”¨`imgae container rm d61`åˆ é™¤å®¹å™¨å†æ¥åˆ é™¤é•œåƒï¼ˆd61ä¸ºå®¹å™¨çš„IDå·å‰ç¼€ï¼‰ï¼Œå¦‚æœæœ‰å¤šä¸ªå®¹å™¨å…³è”äº†è¯¥é•œåƒï¼Œé‚£ä¹ˆéœ€è¦æŠŠè¿™äº›å®¹å™¨éƒ½åˆ é™¤æ‰èƒ½åˆ é™¤è¢«ä½¿ç”¨çš„é•œåƒã€‚
{{< /alert >}}


## åˆ†äº«image
1. é€šè¿‡`docker login`æ¥ç™»å½•Docker hubè´¦å·ã€‚

2. é€šè¿‡`docker image tag hello zhugeqing/hello:1.0`æ¥å°†éœ€è¦åˆ†äº«çš„é•œåƒä¿®æ”¹æˆ`è´¦æˆ·å/imageå:tag`çš„å½¢å¼

3. é€šè¿‡`docker image push zhugeqing/hello:1.0`å°†é•œåƒpushåˆ°ä¸ªäººRepositoriesã€‚

## Scratché•œåƒ
> Scratchæ˜¯ä¸€ä¸ªç©ºçš„Dockeré•œåƒ
