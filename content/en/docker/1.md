---
date: 2021-12-09
description: "å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨"
image: "images/docker.svg"
title: "Dockerå¿«é€Ÿä¸Šæ‰‹"
author: è¯¸è‘›é’
authorEmoji: ğŸ˜ƒ
pinned: false
tags:
- docker
series:
- 
---

## åœ¨Linuxä¸­å®‰è£…Docker
ä»¥rootç”¨æˆ·æƒé™é”®å…¥ä»¥ä¸‹å‘½ä»¤å³å¯å®Œæˆå®‰è£…ï¼ˆé€‚ç”¨äºä»»ä½•ç‰ˆæœ¬çš„Linuxç³»ç»Ÿï¼‰
1. ``curl -fsSL get.docker.com -o get-docker.sh`` æ¥è·å–å®‰è£…çš„è„šæœ¬æ–‡ä»¶
2. ``sh get-docker.sh`` æ‰§è¡Œå·²ç»ä¸‹è½½å¥½çš„è„šæœ¬æ–‡ä»¶
3. ``systemctl start docker`` centoså¯åŠ¨docker
4. ``systemctl enable docker`` centosè®¾ç½®dockerè‡ªå¯åŠ¨


## åŸºæœ¬ä½¿ç”¨
1. ``docker version``æ¥æŸ¥çœ‹dockerç‰ˆæœ¬ï¼Œåˆ¤æ–­æ˜¯å¦å®‰è£…æˆåŠŸ
2. ``docker info`` æ¥æŸ¥çœ‹æ›´åŠ è¯¦ç»†çš„dockerç¯å¢ƒä¿¡æ¯
3. ``docker`` æ¥æŸ¥çœ‹dockerå‘½ä»¤çš„ç”¨æ³•
4. `docker container ls` åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨
> docker ps å’Œ docker container psä¹Ÿæœ‰ä¸€æ ·çš„æ•ˆæœ
5. `docker container ps -a` åˆ—å‡ºæ‰€æœ‰çŠ¶æ€çš„å®¹å™¨ï¼ˆä¸åªæ˜¯æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼‰
6. `docker container run -d nginx` è¿è¡Œnginxè¿™ä¸ªé•œåƒå¹¶ä¸”ä»¥åå°æ–¹å¼è¿è¡Œï¼ˆä¸åŠ -då°±æ˜¯ä»¥å‰å°æ–¹å¼è¿è¡Œï¼‰
> å¦‚æœæ²¡æœ‰è¿™ä¸ªé•œåƒä¼šè‡ªåŠ¨æ‹‰å–
7. `docker container stop 214` åœæ­¢container idä¸º214æˆ–è€…æ˜¯idå‰ç¼€ä¸º214çš„container 
> docker stop 214ä¹Ÿæœ‰ä¸€æ ·çš„æ•ˆæœï¼ˆæ¶‰åŠåˆ°ä»¥å‰ç‰ˆæœ¬çš„dockerä¿ç•™çš„å‘½ä»¤æ ¼å¼ï¼‰
8. `docker container ls -q` åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„ID
9. `docker container stop $(docker container ls -q)` æ‰¹å¤„ç†ï¼Œåœæ­¢æ‰€æœ‰å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨
> `docker container rm $(docker container ls -aq)` åˆ é™¤æ‰€æœ‰å®¹å™¨(å¦‚æœè¦åˆ é™¤è¿è¡ŒçŠ¶æ€çš„è¿˜éœ€è¦åŠ ä¸Š-få¼ºåˆ¶åˆ é™¤çš„å‚æ•°ï¼Œå¦‚
> `docker container rm $(docker container ls -aq) -f`
10. `docker image ls` åˆ—å‡ºæœ¬æœºå·²å®‰è£…çš„dockeré•œåƒ
11. `docker image rm nginx` åˆ é™¤nginxè¿™ä¸ªé•œåƒ
12. `docker conainer --help` æŸ¥çœ‹æ›´å¤šä¸å®¹å™¨æœ‰å…³çš„å‘½ä»¤
13. `docker image --help` æŸ¥çœ‹æ›´å¤šä¸é•œåƒæœ‰å…³çš„å‘½ä»¤
14. `docker system prune -f` åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢è¿è¡Œçš„å®¹å™¨
15. `docker image prune -a` åˆ é™¤æ‰€æœ‰æ²¡æœ‰è¢«ä½¿ç”¨çš„é•œåƒ
16. `docker container run --rm nginx` å½“å®¹å™¨é€€å‡ºæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ é™¤å®¹å™¨
## å®¹å™¨çš„attached å’Œ detachedæ¨¡å¼
åœ¨å¯åŠ¨ä¸€ä¸ªå®¹å™¨åŠ ä¸Š-då‚æ•°å°±å¯ä»¥ä»¥daemonå®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œä¹Ÿå°±æ˜¯detachedæ¨¡å¼ï¼Œ
1. ä»detachedæ¨¡å¼åˆ‡æ¢åˆ°attachedæ¨¡å¼ 
`docker attach zhugeqing` åˆ‡æ¢åˆ°å®¹å™¨IDæˆ–è€…IDå‰ç¼€ä¸ºzhugeqingçš„å®¹å™¨çš„attachedæ¨¡å¼ï¼Œå½“æŒ‰ä¸‹ctrl+cæ—¶ä¼šé€€å‡ºï¼Œå½“ç„¶ï¼ŒåŒæ ·ä¼šåœæ­¢å®¹å™¨

2. åœ¨detachedæ¨¡å¼æŸ¥çœ‹attachedæ¨¡å¼çš„ä¿¡æ¯
`docker container logs zhugeqing` æŸ¥çœ‹å®¹å™¨IDæˆ–è€…IDå‰ç¼€ä¸ºzhugeqingçš„å®¹å™¨çš„æ—¥å¿—ï¼ˆåŠ å…¥-få¯ä»¥åŠ¨æ€è·Ÿè¸ªlogï¼‰

## è¿æ¥å®¹å™¨çš„shell
1. ``docker container run -it ubuntu sh`` åˆ›å»ºä¸€ä¸ªubuntuå®¹å™¨å¹¶è¿›å…¥äº¤äº’å¼æ¨¡å¼
> é”®å…¥exité€€å‡ºshellå¹¶åœæ­¢å®¹å™¨
2. `docker container exec -it c_ID sh`åœ¨ä¸€ä¸ªå·²ç»è¿è¡Œçš„å®¹å™¨ï¼ˆIDä¸ºc_IDï¼‰é‡Œæ‰§è¡Œä¸€ä¸ªé¢å¤–çš„commandï¼Œæ­¤æ—¶è¾“å…¥exité€€å‡ºå‘½ä»¤è¡Œå¹¶ä¸ä¼šåœæ­¢å®¹å™¨

## å®¹å™¨å³æ˜¯è¿›ç¨‹
1. `ps -ef | grep nginx` æŸ¥çœ‹ä¸nginxæœ‰å…³çš„è¿›ç¨‹
```Linux
root         807       1  0 Dec03 ?        00:00:00 nginx: master process /www/server/nginx/sbin/nginx -c /www/server/nginx/conf/nginx.conf
www       355327     807  0 Dec07 ?        00:00:12 nginx: worker process
www       355328     807  0 Dec07 ?        00:00:01 nginx: cache manager process
root      867209  867191  0 22:58 ?        00:00:00 nginx: master process nginx -g daemon off;
101       867260  867209  0 22:58 ?        00:00:00 nginx: worker process
root      868528  859209  0 23:15 pts/0    00:00:00 grep --color=auto nginx
```
<font color=VioletRed> </font>

2. `pstree -halps 867260` æŸ¥çœ‹è¿™ä¸ªnginxè¿›ç¨‹çš„è¿›ç¨‹æ ‘
```Linux
systemd,1 --switched-root --system --deserialize 18
  â””â”€containerd-shim,867191 -namespace moby -id 9c0ce97e9ca1f99ed4bd6b2c11f6ca472786c69fba512bacf7097fce18e75fb8 -address /run/containerd/containerd.sock
      â””â”€nginx,867209
          â””â”€nginx,867260
```
<font color=VioletRed> </font>

> å†ä½¿ç”¨`docker ps`æ¥æŸ¥çœ‹nginxæ‰€å¯¹åº”çš„container IDï¼Œå°±ä¼šå‘ç°ä¸ä¸Šé¢è¿›ç¨‹æ ‘çš„é‚£ä¸ªæœ€é•¿çš„è¿›ç¨‹åé‡Œé¢çš„å­—æ®µä¸€æ ·ï¼Œæ‰€ä»¥è¿è¡Œäº†ä¸€ä¸ªå®¹å™¨å°±æ˜¯è¿è¡Œäº†ä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ `docker top ID`æ¥æŸ¥çœ‹å®¹å™¨çš„è¿›ç¨‹ï¼Œä¸€æ ·æ˜¯å­˜åœ¨äºLinuxç³»ç»Ÿä¸­çš„ã€‚

## docker runèƒŒåçš„æ•…äº‹
`docker container run -d -p 80:80 --name webServer nginx`
> -dè¡¨ç¤ºdaemonå®ˆæŠ¤è¿›ç¨‹ï¼Œ-p 80:80è¡¨ç¤ºå°†å®¹å™¨å†…çš„ç«¯å£80æš´éœ²ç»™å®¹å™¨å¤–çš„ç«¯å£80ç«¯å£ï¼Œå‰é¢çš„æ˜¯å®¹å™¨å¤–ç«¯å£ï¼ˆä¹Ÿå°±æ˜¯ä¸»æœºç«¯å£ï¼‰ï¼Œåé¢çš„æ˜¯å®¹å™¨å†…ç«¯å£ï¼Œ --name webServerè¡¨ç¤ºä¸ºnginxè¿™ä¸ªå®¹å™¨èµ·ä¸€ä¸ªåˆ«åï¼ˆä¸åŠ è¿™ä¸ªå‚æ•°ï¼Œdockerä¼šè‡ªåŠ¨èµ·ä¸€ä¸ªå…¶ä»–çš„åå­—ï¼‰

1. åœ¨æœ¬åœ°æŸ¥æ‰¾æ˜¯å¦æœ‰nginxè¿™ä¸ªimageé•œåƒï¼Œå¦‚æœæ²¡æœ‰å‘ç°
2. å»è¿œç¨‹çš„image registryæŸ¥æ‰¾nginxé•œåƒï¼ˆé»˜è®¤çš„registryæ˜¯Docker Hub)
3. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„nginxé•œåƒ ï¼ˆnginx:latest é»˜è®¤)
4. åŸºäºnginxé•œåƒæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œå¹¶ä¸”å‡†å¤‡è¿è¡Œ
5. docker engineåˆ†é…ç»™è¿™ä¸ªå®¹å™¨ä¸€ä¸ªè™šæ‹ŸIPåœ°å€
6. åœ¨å®¿ä¸»æœºä¸Šæ‰“å¼€80ç«¯å£å¹¶æŠŠå®¹å™¨çš„80ç«¯å£è½¬å‘åˆ°å®¿ä¸»æœºä¸Š
7. å¯åŠ¨å®¹å™¨ï¼Œè¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼ˆä¸€ä¸ªé»˜è®¤shellè„šæœ¬å»å¯åŠ¨nginxï¼‰